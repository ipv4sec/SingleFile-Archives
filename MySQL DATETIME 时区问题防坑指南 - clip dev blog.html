<!DOCTYPE html> <html lang=zh-CN style><!--
 Page saved with SingleFile 
 url: https://cliiip.com/posts/mysql-datetime-timezone-pitfall/ 
 saved date: Mon Nov 06 2023 15:49:05 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)
--><meta charset=utf-8>
<meta http-equiv=X-UA-Compatible content="IE=edge">
<meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>MySQL DATETIME æ—¶åŒºé—®é¢˜é˜²å‘æŒ‡å— - clip dev blog</title>
<meta name=description content="å¤ªé•¿ä¸å¤ªé•¿ä¸çœ‹ç›´æ¥ä¸Šç»“è®º MySQL DATETIME å­—æ®µåœ¨å­˜å‚¨çš„æ—¶å€™åªå­˜å‚¨äº†æ—¶é—´çš„æ•°å­—ä¿¡æ¯ï¼ˆæ¯”å¦‚ 2021-12-04 14:15:38ï¼‰ï¼Œè€Œæ²¡æœ‰å­˜å‚¨æ—¶åŒºï¼›
ç”±äºæ²¡æœ‰å­˜å‚¨æ—¶åŒºï¼Œæ‰€ä»¥å°±ä¾èµ–äº† MySQL serverã€client è¿è¡Œç¯å¢ƒçš„æ—¶åŒºé…ç½®ï¼›
MySQL sever æœ¬èº«è¿è¡Œç¯å¢ƒæœ‰æ—¶åŒºé…ç½®ï¼Œnow() ä¹‹ç±»çš„å†…ç½®å‡½æ•°ï¼Œæˆ–è€… dt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP ä¹‹ç±»è‡ªåŠ¨è®¾ç½®çš„æ—¶é—´ä¾èµ–çš„æ˜¯ MySQL server æœ¬èº«çš„æ—¶åŒºé…ç½®ï¼›
MySQL client ä¸€èˆ¬æ˜¯åº”ç”¨ç¨‹åºï¼Œå½“é€šè¿‡å¯¹åº”è¯­è¨€çš„ mysql-driver è¿æ¥ MySQL æ—¶ï¼Œåœ¨å†™å…¥ã€è¯»å–ã€èŒƒå›´æŸ¥è¯¢æ—¶å¯¹äº DATETIME å­—æ®µå®é™…å‘é€è¿‡å»çš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œæ¯”å¦‚ 2021-12-04 14:20:12ï¼Œä¹Ÿæ˜¯æ²¡æœ‰æ—¶åŒºä¿¡æ¯çš„ï¼Œåº”ç”¨ç¨‹åºå¾€å¾€ä¼šæ ¹æ®é…ç½®æ¥è§£ææˆå¯¹åº”æ—¶åŒºçš„æ—¶é—´ï¼›
æ‰€ä»¥ä½¿ç”¨ DATETIME å­—æ®µå‡ ä¹å°±å¿…é¡»ä¿è¯æ‰€æœ‰ç›¸å…³çš„ client å’Œ server å§‹ç»ˆä½¿ç”¨ä¸€ä¸ªå›ºå®šæ—¶åŒºé…ç½®ï¼Œåªè¦æœ‰ä¸åŒå°±å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚
æ¯”å¦‚ï¼š
 client ä½¿ç”¨çš„æ—¶åŒºå’Œ server ä½¿ç”¨çš„æ—¶åŒºä¸ä¸€è‡´ï¼Œé‚£ä¹ˆ sever çš„ NOW() æˆ–è€… DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP å¾—åˆ°çš„å€¼è¢« client è¯»åˆ°ä¹‹åå‘ç°å·®äº†å‡ ä¸ªå°æ—¶ client1 å’Œ client2 åŒæ—¶ä½¿ç”¨ä¸€ä¸ª serverï¼Œä½†æ˜¯ client1ã€client2 çš„æ—¶åŒºé…ç½®ä¸ä¸€æ ·ï¼Œæˆ–è€… client1 åŸæœ¬é…ç½®äº†æ—¶åŒº Asia/Shanghai åæ¥å˜æˆäº† UTCï¼Œé‚£ä¹ˆè¯»å†™è€æ•°æ®çš„æ—¶å€™å¯èƒ½å‘ç°èŒƒå›´æŸ¥è¯¢æœ‰é—®é¢˜ã€æ›´æ–°ä¸æˆåŠŸï¼ˆæŒ‰æ—¶é—´å¤§å°åšé™å®šæ¡ä»¶æ›´æ–°ï¼‰ã€æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¸¢æ•°æ®â€¦â€¦ç­‰ç­‰çš„è¯¡å¼‚é—®é¢˜  é¿å‘æ–¹æ³•ï¼š">
<meta name=author content>
<style>:root{--gap:3.5rem;--y-gap:8rem;--wide:140rem;--narrow:80rem;--side:calc((var(--wide) - var(--narrow))/2);--header:8rem;--footer:calc(8rem + var(--safe-bottom));--light:255,255,255;--dark:22,22,22;--hljs-bg:#111;--safe-bottom:0}@supports(bottom:constant(safe-area-inset-bottom)){:root{--safe-bottom:constant(safe-area-inset-bottom)}}@supports(bottom:env(safe-area-inset-bottom)){:root{--safe-bottom:env(safe-area-inset-bottom)}}*,*::before,*::after{box-sizing:border-box}html,body{height:100%}html{-webkit-tap-highlight-color:transparent;font-size:8px}body{--white:rgba(var(--light),1);--black:rgba(var(--dark),1);--pro:rgba(var(--dark),1);--lit:rgba(var(--dark),0.64);--air:rgba(var(--dark),0.48);--fog:rgba(var(--dark),0.12);display:flex;flex-direction:column;padding-right:var(--gap);padding-left:var(--gap);margin:0;font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,Oxygen,Ubuntu,Cantarell,open sans,helvetica neue,sans-serif;font-size:2rem;line-height:1.8;color:var(--pro);word-break:break-word;background:var(--white);transition:background .4s ease-out}body>*{flex-shrink:0;width:100%;margin-inline:auto}@media(max-width:1199px){html{font-size:7px}}h1,h2{margin:0;font-weight:700;line-height:1.2}p{margin:0}strong{font-weight:500}ul,ol{padding:0;margin:0}a{color:inherit;text-decoration:none}.header{display:flex;max-width:var(--wide);height:var(--header)}.header a{display:flex;flex-shrink:0;align-items:center}.logo{display:flex;min-width:var(--side);padding-right:var(--gap)}.site-name{max-width:calc(100% - 2rem - 3rem);padding-bottom:.3rem;overflow:auto;font-size:3.4rem;font-weight:700;white-space:nowrap}.btn-dark{width:3rem;margin-left:2rem;cursor:pointer;background:/* original URL: https://cliiip.com/theme.png */url(data:image/png;base64,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)0/auto 3rem no-repeat;transition:background-position .4s steps(5)}.social{display:flex;margin-left:auto}.social a{width:3rem;margin-left:3rem;background:var(--url) center center no-repeat}@media(max-width:1199px){.logo{min-width:auto}}.main{max-width:var(--narrow);min-height:calc(100% - var(--header) - var(--footer));padding-top:var(--y-gap);padding-bottom:var(--y-gap)}.post-title{margin-bottom:calc(var(--y-gap) + 1rem)}.post-title p{display:flex;margin-bottom:1.5rem;font-size:1.6rem;color:var(--air);transform:translateY(.4rem)}.post-title h1{font-size:5rem;transform:translateX(-.3rem)}.post-nav{display:flex;justify-content:space-between;margin-top:var(--y-gap);background:rgba(var(--dark),.05);border-radius:.5rem}.post-nav a{display:flex;align-items:center;width:50%;padding:var(--gap);font-size:2.4rem;font-weight:700;line-height:1.2}.post-nav a span+span{margin-left:1rem}.post-nav .prev{padding-right:1rem}@media(max-width:1199px){.post-title{display:block}}.post-content{font-size:2.2rem}.post-content h2{margin-block:2rem}.post-content h2{margin-top:6rem;font-size:3.5rem}.post-content a{padding-bottom:.2rem;font-weight:500;border-bottom:2px solid var(--pro)}.post-content p,.post-content ul,.post-content ol{margin-bottom:3rem}.post-content ul,.post-content ol{padding-left:2.5rem}.post-content li{margin-top:.6rem}.post-content pre{margin:0 calc(var(--gap)*-1) 4rem;overflow-x:auto;background:var(--hljs-bg) !important;border-radius:.5rem}.post-content code{padding:.5rem 1rem;margin-inline:.5rem;font-family:Menlo,Monaco,courier new,Courier,monospace;font-size:.8em;line-height:1.5;background:rgba(var(--dark),.06);border-radius:.3rem}.post-content pre code{display:block;padding:var(--gap);margin-inline:0;color:rgba(255,255,255,.8);background:0 0;border-radius:0}.footer{display:flex;align-items:center;justify-content:center;max-width:var(--narrow);height:var(--footer);padding-bottom:var(--safe-bottom);margin-top:auto;font-size:1.6rem;color:var(--lit);border-top:1px solid var(--fog)}.footer p+p::before{content:"Â·";margin-inline:.6rem}.footer a:hover{color:var(--pro);border-bottom:1px solid var(--pro)}.hljs-comment{color:#b6b18b}.hljs-params,.hljs-meta{color:#e7ce56}.hljs-string{color:#4fb4d7}.hljs-title{color:#78bb65}.hljs-keyword{color:#b45ea4}.hljs{overflow-x:auto}</style>
<meta name=generator content="Hugo 0.89.4">
<meta property=og:title content="MySQL DATETIME æ—¶åŒºé—®é¢˜é˜²å‘æŒ‡å—">
<meta property=og:description content="ç”±äº DATETIME å­˜å‚¨çš„æ—¶å€™ä¸å¸¦æ—¶åŒºï¼Œè¯»å–åˆ°çš„å€¼ä¾èµ–åº”ç”¨è‡ªå·±é…ç½®çš„æ—¶åŒºï¼Œå½“æ—¶åŒºå˜åŒ–ä¹‹åè¯»å†™æ•°æ®å°±ä¼šè¢«å‘åˆ°â€¦â€¦">
<meta property=og:type content=article>
<meta property=og:url content=https://cliiip.com/posts/mysql-datetime-timezone-pitfall/><meta property=article:section content=posts>
<meta property=article:published_time content=2021-12-04T16:26:36+08:00>
<meta property=article:modified_time content=2021-12-04T16:26:36+08:00>
<meta itemprop=name content="MySQL DATETIME æ—¶åŒºé—®é¢˜é˜²å‘æŒ‡å—">
<meta itemprop=description content="ç”±äº DATETIME å­˜å‚¨çš„æ—¶å€™ä¸å¸¦æ—¶åŒºï¼Œè¯»å–åˆ°çš„å€¼ä¾èµ–åº”ç”¨è‡ªå·±é…ç½®çš„æ—¶åŒºï¼Œå½“æ—¶åŒºå˜åŒ–ä¹‹åè¯»å†™æ•°æ®å°±ä¼šè¢«å‘åˆ°â€¦â€¦"><meta itemprop=datePublished content=2021-12-04T16:26:36+08:00>
<meta itemprop=dateModified content=2021-12-04T16:26:36+08:00>
<meta itemprop=wordCount content=393>
<meta itemprop=keywords content>
<meta name=twitter:card content=summary>
<meta name=twitter:title content="MySQL DATETIME æ—¶åŒºé—®é¢˜é˜²å‘æŒ‡å—">
<meta name=twitter:description content="ç”±äº DATETIME å­˜å‚¨çš„æ—¶å€™ä¸å¸¦æ—¶åŒºï¼Œè¯»å–åˆ°çš„å€¼ä¾èµ–åº”ç”¨è‡ªå·±é…ç½®çš„æ—¶åŒºï¼Œå½“æ—¶åŒºå˜åŒ–ä¹‹åè¯»å†™æ•°æ®å°±ä¼šè¢«å‘åˆ°â€¦â€¦">
<style id=_goober>@keyframes go2264125279{from{transform:scale(0) rotate(45deg);opacity:0}to{transform:scale(1) rotate(45deg);opacity:1}}@keyframes go3020080000{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}@keyframes go463499852{from{transform:scale(0) rotate(90deg);opacity:0}to{transform:scale(1) rotate(90deg);opacity:1}}@keyframes go1268368563{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}@keyframes go1310225428{from{transform:scale(0) rotate(45deg);opacity:0}to{transform:scale(1) rotate(45deg);opacity:1}}@keyframes go651618207{0%{height:0;width:0;opacity:0}40%{height:0;width:6px;opacity:1}100%{opacity:1;height:10px}}@keyframes go901347462{from{transform:scale(0.6);opacity:.4}to{transform:scale(1);opacity:1}}</style><meta name=referrer content=no-referrer><link rel=icon href="data:image/x-icon;base64,AAABAAEAEBAAAAEACABoBQAAFgAAACgAAAAQAAAAIAAAAAEACAAAAAAAAAEAABILAAASCwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAAICAgAGBgYACwsLABISEgAYGBgAGRkZABoaGgAbGxsAHBwcAB0dHQAeHh4AHx8fACAgIAAhISEAIiIiACMjIwAkJCQAJSUlACYmJgAnJycAKCgoACkpKQAqKioAKysrACwsLAAtLS0ALi4uAC8vLwAwMDAAMTExADIyMgAzMzMANDQ0ADU1NQA2NjYANzc3ADg4OAA5OTkAOjo6ADs7OwA8PDwAPT09AD4+PgA/Pz8AQEBAAEFBQQBCQkIAQ0NDAERERABFRUUARkZGAEdHRwBISEgASUlJAEpKSgBLS0sATExMAE1NTQBOTk4AT09PAFBQUABRUVEAUlJSAFNTUwBUVFQAVVVVAFZWVgBXV1cAWFhYAFlZWQBaWloAW1tbAFxcXABdXV0AXl5eAF9fXwBgYGAAYWFhAGJiYgBjY2MAZGRkAGVlZQBmZmYAZ2dnAGhoaABpaWkAampqAGtrawBsbGwAbW1tAG5ubgBvb28AcHBwAHFxcQBycnIAc3NzAHR0dAB1dXUAdnZ2AHd3dwB4eHgAeXl5AHp6egB7e3sAfHx8AH19fQB+fn4Af39/AICAgACBgYEAgoKCAIODgwCEhIQAhYWFAIaGhgCHh4cAiIiIAImJiQCKiooAi4uLAIyMjACNjY0Ajo6OAI+PjwCQkJAAkZGRAJKSkgCTk5MAlJSUAJWVlQCWlpYAl5eXAJiYmACZmZkAmpqaAJubmwCcnJwAnZ2dAJ6engCfn58AoKCgAKGhoQCioqIAo6OjAKSkpAClpaUApqamAKenpwCoqKgAqampAKqqqgCrq6sArKysAK2trQCurq4Ar6+vALCwsACxsbEAsrKyALOzswC0tLQAtbW1ALa2tgC3t7cAuLi4ALm5uQC6uroAu7u7ALy8vAC9vb0Avr6+AL+/vwDAwMAAwcHBAMLCwgDDw8MAxMTEAMXFxQDGxsYAx8fHAMjIyADJyckAysrKAMvLywDMzMwAzc3NAM7OzgDPz88A0NDQANHR0QDS0tIA09PTANTU1ADV1dUA1tbWANfX1wDY2NgA2dnZANra2gDb29sA3NzcAN3d3QDe3t4A4ODgAOfn5wDx8fEA+fn5AP39/QD+/v4A/v7+AP7+/gD+/v4A/v7+AP7+/gD+/v4A/v7+AP7+/gD+/v4A/v7+AP7+/gD+/v4A/v7+AP7+/gD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A+fn5+fn5+fn5+fn5+fn5+fkJCQkJCQkJCQkJCQkJCQn5Cfn5+fn5+fn5+fn5+fn5+Qn5CQn5+fn5+QkJCQn5+fkJ+fn5Cfn5+Qn5+fkJ+fn5Cfn5+fkJ+Qn5+fn5Cfn5+Qn5+fn5+Qn5+fn5+Qn5+fkJ+QkJCQkJCQkJCfkJ+fn5Cfn5+Qn5CfkJ+fn5Cfn5+Qn5+fkJ+Qn5Cfn5+Qn5+fkJ+fkJCQkJCQkJ+fkJ+fn5Cfn5+fn5Cfn5+fn5Cfn5+Qn5+fn5+Qn5+fn5+Qn5+fkJ+fn5+fn5+fn5+fkJ+fn5CQkJCQkJCQkJCQkJCfn5+fn5+fn5+fn5+fn5+fn5+QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=" data-sf-original-href=https://cliiip.com/favicon.ico><link rel=canonical href=https://cliiip.com/posts/mysql-datetime-timezone-pitfall/><meta http-equiv=content-security-policy content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:; object-src 'self' data:; frame-src 'self' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
 <body data-menu=false>
 <header class=header>
 
 <p class=logo>
 <a class=site-name href=https://cliiip.com/>clip dev blog</a><a class=btn-dark></a>
 </p>
 
 
 
 
 
 <nav class=social>
 
 <a class=github style="--url:/* original URL: https://cliiip.com/posts/mysql-datetime-timezone-pitfall/github.svg */url(data:,)" href=https://github.com/binderclip target=_blank></a>
 
 </nav>
 
</header>
 <main class=main>
<article class=post-single>
 <header class=post-title>
 <p>
 <time>Dec 4, 2021</time>
 
 </p>
 <h1>MySQL DATETIME æ—¶åŒºé—®é¢˜é˜²å‘æŒ‡å—</h1>
 </header>
 <section class=post-content><h2 id=å¤ªé•¿ä¸å¤ªé•¿ä¸çœ‹ç›´æ¥ä¸Šç»“è®º>å¤ªé•¿ä¸å¤ªé•¿ä¸çœ‹ç›´æ¥ä¸Šç»“è®º</h2>
<p>MySQL DATETIME å­—æ®µåœ¨å­˜å‚¨çš„æ—¶å€™åªå­˜å‚¨äº†æ—¶é—´çš„æ•°å­—ä¿¡æ¯ï¼ˆæ¯”å¦‚ 2021-12-04 14:15:38ï¼‰ï¼Œè€Œæ²¡æœ‰å­˜å‚¨æ—¶åŒºï¼›</p>
<p>ç”±äºæ²¡æœ‰å­˜å‚¨æ—¶åŒºï¼Œæ‰€ä»¥å°±ä¾èµ–äº† MySQL serverã€client è¿è¡Œç¯å¢ƒçš„æ—¶åŒºé…ç½®ï¼›</p>
<p>MySQL sever æœ¬èº«è¿è¡Œç¯å¢ƒæœ‰æ—¶åŒºé…ç½®ï¼Œ<code>now()</code> ä¹‹ç±»çš„å†…ç½®å‡½æ•°ï¼Œæˆ–è€… <code>dt DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</code> ä¹‹ç±»è‡ªåŠ¨è®¾ç½®çš„æ—¶é—´ä¾èµ–çš„æ˜¯ MySQL server æœ¬èº«çš„æ—¶åŒºé…ç½®ï¼›</p>
<p>MySQL client ä¸€èˆ¬æ˜¯åº”ç”¨ç¨‹åºï¼Œå½“é€šè¿‡å¯¹åº”è¯­è¨€çš„ mysql-driver è¿æ¥ MySQL æ—¶ï¼Œåœ¨å†™å…¥ã€è¯»å–ã€èŒƒå›´æŸ¥è¯¢æ—¶å¯¹äº DATETIME å­—æ®µå®é™…å‘é€è¿‡å»çš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹çš„ï¼Œæ¯”å¦‚ <code>2021-12-04 14:20:12</code>ï¼Œä¹Ÿæ˜¯æ²¡æœ‰æ—¶åŒºä¿¡æ¯çš„ï¼Œåº”ç”¨ç¨‹åºå¾€å¾€ä¼šæ ¹æ®é…ç½®æ¥è§£ææˆå¯¹åº”æ—¶åŒºçš„æ—¶é—´ï¼›</p>
<p>æ‰€ä»¥ä½¿ç”¨ DATETIME å­—æ®µå‡ ä¹å°±å¿…é¡»ä¿è¯æ‰€æœ‰ç›¸å…³çš„ client å’Œ server å§‹ç»ˆä½¿ç”¨ä¸€ä¸ªå›ºå®šæ—¶åŒºé…ç½®ï¼Œåªè¦æœ‰ä¸åŒå°±å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ol>
<li>client ä½¿ç”¨çš„æ—¶åŒºå’Œ server ä½¿ç”¨çš„æ—¶åŒºä¸ä¸€è‡´ï¼Œé‚£ä¹ˆ sever çš„ <code>NOW()</code> æˆ–è€… <code>DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</code> å¾—åˆ°çš„å€¼è¢« client è¯»åˆ°ä¹‹åå‘ç°å·®äº†å‡ ä¸ªå°æ—¶</li>
<li>client1 å’Œ client2 åŒæ—¶ä½¿ç”¨ä¸€ä¸ª serverï¼Œä½†æ˜¯ client1ã€client2 çš„æ—¶åŒºé…ç½®ä¸ä¸€æ ·ï¼Œæˆ–è€… client1 åŸæœ¬é…ç½®äº†æ—¶åŒº Asia/Shanghai åæ¥å˜æˆäº† UTCï¼Œé‚£ä¹ˆè¯»å†™è€æ•°æ®çš„æ—¶å€™å¯èƒ½å‘ç°èŒƒå›´æŸ¥è¯¢æœ‰é—®é¢˜ã€æ›´æ–°ä¸æˆåŠŸï¼ˆæŒ‰æ—¶é—´å¤§å°åšé™å®šæ¡ä»¶æ›´æ–°ï¼‰ã€æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¸¢æ•°æ®â€¦â€¦ç­‰ç­‰çš„è¯¡å¼‚é—®é¢˜</li>
</ol>
<p><strong>é¿å‘æ–¹æ³•ï¼š</strong></p>
<ol>
<li>ç»§ç»­ç”¨ DATETIME å­—æ®µï¼Œä½†åŠ ä»¥æ³¨æ„
<ul>
<li>æ¯•ç«Ÿæœ‰äº›ç‰¹æ€§æ˜¯æ— æ³•å–ä»£çš„ï¼ˆDEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP æˆ–è€…ä¸€äº›æ—¶é—´å‡½æ•°çš„æ“ä½œï¼‰æˆ–è€…éœ€è¦ä½¿ç”¨ä¸€äº› DATETIME ç›¸å…³çš„å‡½æ•°æ“ä½œ</li>
<li>é‚£ä¹ˆè¿™æ—¶å€™å°½é‡ä¿è¯ MySQL æœåŠ¡å™¨çš„æ—¶åŒºé…ç½®å’Œ client çš„æ—¶åŒºé…ç½®ç›¸åŒ</li>
<li>å¦‚æœæœºæˆ¿ä»…éƒ¨ç½²åœ¨å›½å†…ï¼Œæœªæ¥ä¹Ÿä¸ä¼šå†å…¶ä»–å›½å®¶ã€åœ°åŒºéƒ¨ç½²ï¼Œä¸šåŠ¡ä¹Ÿä»…é™äºå›½å†…ï¼Œé‚£ä¹ˆä½¿ç”¨å›ºå®šæ—¶åŒºé—®é¢˜ä¸å¤§</li>
<li>å¦‚æœæœºæˆ¿å¯èƒ½éƒ¨ç½²åœ¨å…¶ä»–å›½å®¶ã€åœ°åŒºï¼Œé‚£ä¹ˆéƒ¨ç½²çš„æ—¶å€™è¦ä¹ˆå†™æ­»å…¨éƒ½ç”¨ +8 æ—¶åŒºï¼Œæ¯”å¦‚ Asia/Shanghaiï¼Œæˆ–è€…å›ºå®š UTC æ—¶åŒºï¼Œæˆ–è€…ä½¿ç”¨å„åœ°æ—¶åŒºï¼Œä½†å¤„ç†å¥½ä¸åŒæ—¶åŒºä¹‹é—´æœºå™¨é—´çš„æ•°æ®äº¤äº’ï¼ˆæ€»ä½“è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“å‡ºé—®é¢˜çš„ï¼ŒæŸä¸ªç¯èŠ‚æ¼æ‰å°±å¯èƒ½å¯¼è‡´é—®é¢˜ï¼Œæ¯”å¦‚æ–‡åçš„â€œDATETIME æ—¶åŒºè¸©å‘â€ï¼‰</li>
</ul>
</li>
<li>æ”¹ç”¨ TIMESTAMP å­˜å‚¨æ—¶é—´æˆ³
<ul>
<li>ç±»ä¼¼ DATETIME å­—æ®µï¼Œä¸”æ”¯æŒä¸€äº› MySQL è‡ªå¸¦çš„æ—¶é—´æ›´æ–°ã€å‡½æ•°æ“ä½œ</li>
<li>å¯èƒ½ä¼šåœ¨æ›´æ–°è¡Œè®°å½•çš„æ—¶å€™è‡ªåŠ¨æ›´æ–°è¡Œå†… TIMESTAMP ç±»å‹å­—æ®µçš„å€¼ï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹</li>
<li>æœ‰æ•ˆèŒƒå›´æ¯” DATETIME è¦å°ï¼Œä» <code>'1970-01-01 00:00:01.000000'</code> UTC åˆ° <code>'2038-01-19 03:14:07.999999'</code> UTCï¼Œç›®å‰ 2021 å¹´ï¼Œæœ‰æ•ˆæ—¶é—´ä¸é•¿äº†</li>
</ul>
</li>
<li>æ”¹ç”¨ int å­˜å‚¨æ—¶é—´æˆ³
<ul>
<li>å¦‚æœç¨‹åºé‡Œé¢çš„æ—¶é—´å­—æ®µå…¨éƒ½æ¥è‡ªäºç¨‹åºè®¾ç½®ï¼Œä¸”åªéœ€è¦ä¸€äº›ç®€å•æ“ä½œï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ int æ¥è¡¨ç¤º</li>
<li>æ—¶é—´æˆ³ä¸å—æ—¶åŒºå½±å“ï¼Œåœ¨ä¸åŒæ—¶åŒºçš„åŒä¸€æ—¶åˆ»è·å–çš„æ—¶é—´æˆ³æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥ä¸ä¼šå­˜åœ¨æ—¶åŒºé—®é¢˜</li>
<li>éœ€è¦æ³¨æ„ä¸€ä¸‹ä½¿ç”¨ INT è¿˜æ˜¯ BIGINTï¼Œä»¥åŠä½¿ç”¨çš„æ—¶é—´æˆ³çš„ç²¾åº¦æ˜¯ sã€msã€us è¿˜æ˜¯ ns</li>
</ul>
</li>
</ol>
<p>å¦‚æœæƒ³ç»§ç»­äº†è§£ä¸€äº›ç»†èŠ‚ï¼Œæ¬¢è¿é˜…è¯»åé¢çš„éƒ¨åˆ† ğŸ‘‡ğŸ»</p>
<h2 id=mysql-çš„-time-ç±»å‹å­˜å‚¨>MySQL çš„ time ç±»å‹å­˜å‚¨</h2>
<p>è¯¦è§ï¼š</p>
<p><a href=https://dev.mysql.com/doc/internals/en/date-and-time-data-type-representation.html>MySQL :: MySQL Internals Manual :: 10.9 Date and Time Data Type Representation</a></p>
<p>åˆ’é‡ç‚¹ï¼š</p>
<ul>
<li>5.6.4 å‰å’Œåå®ç°æœ‰æ‰€ä¸åŒï¼Œè¿™é‡Œåªè¯´ 5.6.4 åŠä»¥å</li>
<li>DATETIME æœ‰å¯é€‰çš„å°æ•°éƒ¨åˆ†ï¼Œæ ¹æ®å°æ•°ä½æ•°ä¸åŒï¼Œå ç”¨ä¸åŒçš„å­˜å‚¨ç©ºé—´</li>
<li>TIMESTAMP ä¹Ÿæœ‰å¯é€‰çš„å°æ•°éƒ¨åˆ†ä»¥æ»¡è¶³ä¸åŒè¿›åº¦çš„éœ€è¦</li>
</ul>
<pre tabindex=0><code class="hljs properties"><span class=hljs-attr>DATETIME</span> <span class=hljs-string>æ•´æ•°éƒ¨åˆ†ï¼š</span>
 <span class=hljs-attr>1</span> <span class=hljs-string>bit  sign           (1= non-negative, 0= negative)</span>
<span class=hljs-attr>17</span> <span class=hljs-string>bits year*13+month  (year 0-9999, month 0-12) (2^17 = 131072)</span>
 <span class=hljs-attr>5</span> <span class=hljs-string>bits day            (0-31) (2^5 = 32)</span>
 <span class=hljs-attr>5</span> <span class=hljs-string>bits hour           (0-23)</span>
 <span class=hljs-attr>6</span> <span class=hljs-string>bits minute         (0-59)</span>
 <span class=hljs-attr>6</span> <span class=hljs-string>bits second         (0-59) (2^6 = 64)</span>
<span class=hljs-attr>---------------------------</span>
<span class=hljs-attr>40</span> <span class=hljs-string>bits = 5 bytes</span>

<span class=hljs-attr>TIMESTAMP</span> <span class=hljs-string>æ•´æ•°éƒ¨åˆ†ï¼š</span>
<span class=hljs-attr>4</span> <span class=hljs-string>bytes 2^32 = 4294967296 2106-02-07 06:28:16 UTC</span>
<span class=hljs-meta>2^31</span> = <span class=hljs-string>2147483648 2038-01-19 03:14:08 UTC</span>
<span class=hljs-meta>//</span> <span class=hljs-string>å¯èƒ½ç¬¬ä¸€ä¸ª bit ç”¨æ¥åšä¸€äº›å…¶ä»–å·¥ä½œï¼Œæ–‡æ¡£ä¸­æ²¡æœ‰è¯¦ç»†æå†™</span>

<span class=hljs-attr>å°æ•°éƒ¨åˆ†ï¼š</span>
<span class=hljs-attr>0</span>     <span class=hljs-string>0 bytes</span>
<span class=hljs-meta>1,2</span>   <span class=hljs-string>1 byte  (2^8 = 256)</span>
<span class=hljs-meta>3,4</span>   <span class=hljs-string>2 bytes (2^16 = 65536)</span>
<span class=hljs-meta>4,5</span>   <span class=hljs-string>3 bytes (2^24 = 16777216)</span>
</code></pre><p>æ ¹æ®å­˜å‚¨å®ç°å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡º DATETIME æ˜¯æ²¡æœ‰å­˜å‚¨æ—¶åŒºä¿¡æ¯çš„ã€‚</p>
<h2 id=golang-mysql-driver-ä¸­-timetime-åˆ°-datetime-çš„è½¬æ¢>golang mysql-driver ä¸­ time.Time åˆ° DATETIME çš„è½¬æ¢</h2>
<p>é¡¹ç›®åœ°å€ï¼š<a href=https://github.com/go-sql-driver/mysql>go-sql-driver/mysql</a></p>
<pre tabindex=0><code class="hljs cs"><span class=hljs-comment>// packets.go:909</span>
writeExecutePacket
  <span class=hljs-comment>// æ˜¯å®é™…çš„æŠŠè¯­å¥ä¼ è¾“ç»™ MySQL çš„å‡½æ•°</span>
  <span class=hljs-comment>// å¯¹äº time ç±»å‹çš„ arg ä¼šåšä¸€æ¬¡è½¬æ¢</span>
  appendDateTime(b, v.In(mc.cfg.Loc)) <span class=hljs-comment>// appendDateTime åŸºæœ¬æ˜¯ä¸€ä¸ª timeToString çš„æ“ä½œï¼Œå…³é”®æ˜¯è¿™é‡Œæœ‰ä¸€æ¬¡è½¬æ¢æ—¶åŒº</span>

<span class=hljs-comment>// æˆ–è€…å¦‚ä½•è®¾ç½®äº† InterpolateParamsï¼ˆæå‰æŠŠå‚æ•°æ”¾å…¥ SQLï¼‰</span>
<span class=hljs-comment>// é‚£ä¹ˆåœ¨ connection.go:297 Exec å‡½æ•°ä¸­ä¼šè°ƒç”¨ interpolateParams</span>
<span class=hljs-comment>// connection.go:198</span>
<span class=hljs-function>interpolateParams
  <span class=hljs-title>appendDateTime</span>(<span class=hljs-params>buf, v.In(mc.cfg.Loc</span>)) <span class=hljs-comment>// åŒæ ·ä¼šæœ‰ appendDateTime çš„ time.Time è½¬ string çš„æ“ä½œ</span>

<span class=hljs-comment>// è‡³äº mc.cfg.Loc çš„é…ç½®ï¼Œæ¥è‡ªæœ€å¼€å§‹çš„ MySQL è®¾ç½®ï¼Œå¯ä»¥æ˜¯ä¸“é—¨çš„ Configï¼Œæˆ–è€…æ˜¯ä» DSN å­—ç¬¦ä¸²ä¸­è§£æ</span>
<span class=hljs-comment>// dsn.go:369</span>
parseDSNParams
  <span class=hljs-comment>// è§£æ DSN</span>
  <span class=hljs-comment>// å¯¹äº loc</span>
  cfg.Loc, err</span> = time.LoadLocation(<span class=hljs-keyword>value</span>) <span class=hljs-comment>// å®é™…å°±æ˜¯æ‰§è¡Œäº†ä¸€æ¬¡ golang çš„ LoadLocation æ“ä½œ</span>
                                          <span class=hljs-comment>// ä¸€èˆ¬æƒ…å†µæ˜¯ =Localï¼Œé‚£ä¹ˆå°±ä¾èµ– golang è¿è¡Œçš„ç¯å¢ƒäº†</span>
</code></pre><h2 id=datetime-æ—¶åŒºè¸©å‘>DATETIME æ—¶åŒºè¸©å‘</h2>
<p>å·¥ä½œé‡Œé¢æœ‰ä¸ªé¡¹ç›®ï¼Œä»£ç åŒæ—¶åœ¨å›½å†…å’Œæµ·å¤–çš„æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œæ•°æ®æ˜¯éš”ç¦»çš„ï¼Œå·²ç»å¹³ç¨³åœ°è¿è¡Œäº†ä¸€æ®µæ—¶é—´ã€‚</p>
<p>å®é™…ä¸ŠæœåŠ¡çš„å¯åŠ¨è„šæœ¬é‡Œé¢å¼ºåˆ¶è®¾ç½®äº† <code>TZ=Asia/Shanghai</code>ï¼ˆgolang ä¼šä¾é è¿™ä¸ªç¯å¢ƒå˜é‡ä½œä¸º Local çš„æ—¶åŒºï¼‰ï¼Œåœ¨æµ·å¤–çš„æœåŠ¡å™¨ä¸ŠåŸæœ¬ä¹Ÿæ˜¯è¿™ä¹ˆè¿è¡Œçš„ï¼Œæ‰€ä»¥æµ·å¤–çš„æ•°æ®åº“é‡Œé¢æ”¾çš„æ—¶é—´æ¯”å¦‚ <code>2021-12-04 16:00:00</code> å…¶å®æ˜¯æŒ‡åŒ—äº¬æ—¶é—´ï¼ˆ+8 æ—¶åŒºï¼‰çš„ä¸‹åˆ 16 ç‚¹ã€‚</p>
<p>ç”±äºè¿™ä¸ªè®¾ç½®æ¯”è¾ƒä¹…è¿œï¼Œå½“æ—¶æ·»åŠ çš„åŒäº‹æ—©å°±ä¸è´Ÿè´£è¿™ä¸ªé¡¹ç›®äº†ã€‚åœ¨è¿ç§»ä»£ç ä»“åº“çš„æ—¶å€™æ¼æ‰äº†è¿™ä¸ªç¯å¢ƒå˜é‡é…ç½®ï¼Œå¯¼è‡´æ–°çš„é¡¹ç›®éƒ¨ç½²ä¹‹åä¼ è¾“ç»™æ•°æ®åº“çš„æ˜¯ UTC æ—¶é—´ï¼Œè¿™æ ·å°±å¯¼è‡´å‡ºç°é—®é¢˜äº†ã€‚</p>
<p>æ›´æ–°æ•°æ®çš„æ—¶å€™æœ‰ <code>where update_time &lt; ?</code> çš„åˆ¤æ–­ï¼Œå› ä¸ºè¿™æ¬¡ä¼ äº† UTCï¼ˆUTC æ˜¯ +0 æ—¶åŒºï¼Œ+8 æ—¶åŒºçš„ <code>2021-12-04 16:00:00</code> å¯¹åº”äº† +0 æ—¶åŒºçš„ <code>2021-12-04 08:00:00</code>ï¼‰ï¼Œè¿™æ ·å»æ•°æ®åº“æ›´æ–°çš„æ—¶å€™å¦‚æœå‰é¢ä¸ä¹…ç”¨ +8 æ—¶åŒºæ—¶é—´æ›´æ–°è¿‡ï¼Œæ•°æ®åº“é‡Œçš„ update_time æ¯”ä¼ å…¥çš„è¿˜å¤§ï¼Œæ‰€ä»¥å°±æ›´æ–°ä¸ä¸Šï¼Œç”¨æˆ·çš„æ•°æ®å°±å¤„ç†é”™è¯¯äº†ã€‚</p>
<p>ç±»ä¼¼çš„ï¼ŒæŸ¥è¯¢æ•°æ®çš„æ—¶å€™åŸæœ¬æƒ³æŸ¥è¯¢ now ä¹‹å‰çš„ï¼ˆ<code>where update_time &lt; '2021-12-04 16:00:00'</code>ï¼‰ï¼Œå°±å˜æˆäº† now-8h ä¹‹å‰çš„ï¼ˆ<code>where update_time &lt; '2021-12-04 08:00:00'</code>ï¼‰ï¼Œå¯¼è‡´æ¼æŸ¥äº†æœ€è¿‘ 8 å°æ—¶çš„æ•°æ®ã€‚</p>
</section>
 
 
 
 
 
 <nav class=post-nav>
 
 <a class=prev href=https://cliiip.com/posts/case-thanks-to-rocketmqs-dead-letter-queue/><span>â†</span><span>å®é™… caseï¼šå¤šäºäº† RocketMQ çš„æ­»ä¿¡é˜Ÿåˆ—</span></a>
 
 </nav>
 
 
 
</article>
</main>
 <footer class=footer>
 <p>Â© 2022 <a href=https://cliiip.com/>clip dev blog</a></p>
 <p>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugoï¸ï¸</a>ï¸</p>
 <p>
 <a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper 5.1</a>
 </p>
</footer>
 
